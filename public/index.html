<!--
  Vue3 æ”¹å¯«æŸ¥è©¢é é¢
  1. ä½¿ç”¨ CDN æ–¹å¼å¼•å…¥ Vue3
  2. ä»¥ table å‘ˆç¾æŸ¥è©¢çµæœ
  3. data: big mac index json è³‡æ–™
  4. method: é¸æ“‡ name å¾Œè‡ªå‹• fetch /api/quotes
  5. æ¯æ¬¡ä¿®æ”¹çš†æœ‰è¨»è§£
-->
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>Big Mac Index æŸ¥è©¢ (Vue3)</title>
  <meta name="description" content="ç”±ç¶“æ¿Ÿå­¸äººç·¨è£½ï¼Œäº†è§£å„åœ‹å¤§éº¥å…‹æ¼¢å ¡åƒ¹æ ¼èˆ‡è²¨å¹£æ¯”è¼ƒã€‚è³‡æ–™ä¾†æºï¼šhttps://github.com/TheEconomist/big-mac-data">
  <link rel="stylesheet" href="/stylesheets/style.css">
  <!-- ä¿®æ­£ï¼šæ”¹ç”¨é–‹ç™¼ç‰ˆæœ¬çš„ Vue3 CDNï¼Œä¾¿æ–¼èª¿è©¦éŒ¯èª¤ -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <!-- æ–°å¢ï¼šå¼•å…¥ Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- æ–°å¢ï¼šå¼•å…¥ Leaflet åœ°åœ–åº« CDNï¼Œç”¨æ–¼ Choropleth Map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- æ–°å¢ï¼šå¼•å…¥ Charts Container æ•¸æ“šé è™•ç†æ¨¡çµ„ -->
  <script src="/charts-container.js"></script>
  <!-- ä¿®æ­£ï¼šç§»é™¤ Vue 3 åœ–è¡¨è¨ˆç®—çµ„åˆå¼å‡½æ•¸ -->
  <!-- <script src="/chart-computed-vue.js"></script> -->
</head>
<body>
  <div id="app">
    <h1>Big Mac Index æŸ¥è©¢</h1>
    <!-- åœ¨ <h1>Big Mac Index æŸ¥è©¢ (Vue3)</h1> å¾Œæ·»åŠ  -->
    <div class="intro-section">
      <p>
        <strong>å¤§éº¥å…‹æŒ‡æ•¸ï¼ˆBig Mac Indexï¼‰</strong>ç”±ã€Šç¶“æ¿Ÿå­¸äººã€‹é›œèªŒç·¨è£½ï¼Œé€éæ¯”è¼ƒå„åœ‹å¤§éº¥å…‹æ¼¢å ¡çš„åƒ¹æ ¼ä¾†è¡¡é‡è²¨å¹£çš„è³¼è²·åŠ›å¹³åƒ¹ï¼ˆPPPï¼‰ã€‚
        é€™å€‹æŒ‡æ•¸ä»¥ä¸€ç¨®ç°¡å–®æ˜“æ‡‚çš„æ–¹å¼å¹«åŠ©äº†è§£ä¸åŒåœ‹å®¶è²¨å¹£çš„ç›¸å°åƒ¹å€¼ã€‚
      </p>
      <p class="data-source">
        è³‡æ–™ä¾†æºï¼š<a href="https://github.com/TheEconomist/big-mac-data" target="_blank" rel="noopener">The Economist Big Mac Data</a>
      </p>
    </div>

<!--    &lt;!&ndash; æ–°å¢ï¼šChoropleth Map å…¨çƒè²¨å¹£é«˜ä½ä¼°åœ°ç†è¦–è¦ºåŒ– &ndash;&gt;-->
<!--    <div class="choropleth-container" v-if="choroplethData.data && choroplethData.data.length">-->
<!--      <div class="choropleth-section">-->
<!--        <h2 class="choropleth-title">-->
<!--          å…¨çƒè²¨å¹£é«˜ä½ä¼°åœ°ç†åˆ†å¸ƒåœ–-->
<!--          <span class="data-date">ï¼ˆ{{ choroplethData.date }} æœ€æ–°æ•¸æ“šï¼‰</span>-->
<!--        </h2>-->
<!--        <div class="choropleth-description">-->
<!--          <p>-->
<!--            æ­¤åœ°åœ–é¡¯ç¤ºå„åœ‹è²¨å¹£ç›¸å°æ–¼ç¾å…ƒçš„é«˜ä¼°æˆ–ä½ä¼°ç¨‹åº¦ï¼ˆUSD_adjustedï¼‰ã€‚-->
<!--            <span class="color-legend">-->
<!--              <span class="legend-item undervalued">ç¶ è‰²ï¼šè¢«ä½ä¼°</span>-->
<!--              <span class="legend-item neutral">æ©™è‰²ï¼šæ¥è¿‘å¹³åƒ¹</span>-->
<!--              <span class="legend-item overvalued">ç´…è‰²ï¼šè¢«é«˜ä¼°</span>-->
<!--            </span>-->
<!--          </p>-->
<!--        </div>-->
<!--        <div id="choroplethMap" class="map-container"></div>-->
<!--      </div>-->
<!--    </div>-->

    <!-- æ–°å¢ï¼šå…¨çƒå¤§éº¥å…‹çµ±è¨ˆå¡ç‰‡ -->
    <div class="stats-cards-container" v-if="globalStats.hasData">
      <div class="stats-grid">
        <div class="stat-card most-expensive">
          <div class="card-header">
            <h3>ğŸ’° æœ€è²´å¤§éº¥å…‹</h3>
            <span class="card-subtitle">ç¾å…ƒåƒ¹æ ¼æœ€é«˜</span>
          </div>
          <div class="card-content">
            <div class="main-value">${{ globalStats.mostExpensive.dollar_price }}</div>
            <div class="country-name">{{ globalStats.mostExpensive.name }}</div>
            <div class="additional-info">
              <span class="local-price">{{ globalStats.mostExpensive.local_price }} {{ globalStats.mostExpensive.currency_code }}</span>
              <span class="date">{{ globalStats.date }}</span>
            </div>
          </div>
        </div>

        <div class="stat-card cheapest">
          <div class="card-header">
            <h3>ğŸ·ï¸ æœ€ä¾¿å®œå¤§éº¥å…‹</h3>
            <span class="card-subtitle">ç¾å…ƒåƒ¹æ ¼æœ€ä½</span>
          </div>
          <div class="card-content">
            <div class="main-value">${{ globalStats.cheapest.dollar_price }}</div>
            <div class="country-name">{{ globalStats.cheapest.name }}</div>
            <div class="additional-info">
              <span class="local-price">{{ globalStats.cheapest.local_price }} {{ globalStats.cheapest.currency_code }}</span>
              <span class="date">{{ globalStats.date }}</span>
            </div>
          </div>
        </div>

        <div class="stat-card best-value">
          <div class="card-header">
            <h3>ğŸ¯ å¤§éº¥å…‹æœ€è¶…å€¼</h3>
            <span class="card-subtitle">USDèª¿æ•´å€¼æœ€ä½</span>
          </div>
          <div class="card-content">
            <div class="main-value">{{ (globalStats.bestValue.percentageDeviation >= 0 ? '+' : '') + globalStats.bestValue.percentageDeviation.toFixed(1) }}%</div>
            <div class="country-name">{{ globalStats.bestValue.name }}</div>
            <div class="additional-info">
              <span class="local-price">${{ globalStats.bestValue.dollar_price }} USD</span>
              <span class="date">{{ globalStats.date }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- æŸ¥è©¢é¸é …å€åŸŸ -->
    <div class="form-row">
      <!-- ä¸‹æ‹‰é¸å–®ï¼Œé¸æ“‡åœ‹å®¶/åœ°å€ -->
      <label>æŸ¥è©¢åœ‹å®¶/åœ°å€ï¼š
        <select v-model="selectedName" @change="fetchByName" class="custom-select">
          <option value="">è«‹é¸æ“‡</option>
          <option v-for="name in names" :key="name" :value="name">{{ name }}</option>
        </select>
      </label>
      <!-- æ–°å¢ï¼šå¹´ä»½ä¸‹æ‹‰é¸å–®ï¼Œåƒ…åœ¨å·²é¸æ“‡åœ‹å®¶/åœ°å€æ™‚é¡¯ç¤º -->
      <label v-if="selectedName">é¸æ“‡æ™‚é–“å€é–“ï¼š
        <select v-model="startYear" class="custom-select">
          <option value="">èµ·å§‹å¹´ä»½</option>
          <option v-for="year in years" :key="'start-' + year" :value="year">{{ year }}</option>
        </select>
        <span style="margin: 0 6px;">è‡³</span>
        <select v-model="endYear" class="custom-select">
          <option value="">çµæŸå¹´ä»½</option>
          <option v-for="year in years" :key="'end-' + year" :value="year">{{ year }}</option>
        </select>
      </label>

      <label v-if="result.length || compareResult.length">æ’åºæ–¹å¼ï¼š
        <select v-model="sortOrder" class="custom-select">
          <option value="asc">æ—¥æœŸå‡åº</option>
          <option value="desc">æ—¥æœŸé™åº</option>
        </select>
      </label>
    </div>
    <!-- æŸ¥è©¢é¸é …çµæŸ -->

    <!-- ä¿®æ”¹ï¼šåœ–è¡¨å®¹å™¨ç§»è‡³è¡¨æ ¼å‰æ–¹ï¼Œæ”¯æ´é›™åœ–è¡¨ä¸¦æ’é¡¯ç¤º -->
    <div class="charts-container" v-if="result.length">
      <div class="chart-container enhanced-chart">
        <h2 class="chart-title">{{ selectedName }} ç•¶åœ°åƒ¹æ ¼èµ°å‹¢åœ–</h2>
        <!-- æ–°å¢ï¼šåœ–è¡¨ canvas å…ƒç´  -->
        <canvas id="localPriceChart"></canvas>
      </div>
      <div class="chart-container enhanced-chart">
        <h2 class="chart-title">{{ selectedName }} ç¾å…ƒåƒ¹æ ¼èµ°å‹¢åœ–</h2>
        <!-- æ–°å¢ï¼šåœ–è¡¨ canvas å…ƒç´  -->
        <canvas id="usdAdjustedChart"></canvas>
      </div>
    </div>

    <!-- æŸ¥è©¢çµæœå€åŸŸç¾åŒ– -->
    <div class="table-container enhanced-table">
      <!-- ä¸»è¦æŸ¥è©¢çµæœ table -->
      <div class="table-section" v-if="result.length">
        <h2 class="table-title">{{ selectedName }} æŸ¥è©¢çµæœ</h2>
        <table border="1">
          <thead>
            <tr>
              <th>æ—¥æœŸ</th>
              <th>åœ‹å®¶/åœ°å€</th>
              <th>è²¨å¹£ä»£ç¢¼</th>
              <th>ç•¶åœ°åƒ¹æ ¼</th>
              <th>åŒ¯ç‡</th>
              <th>ç¾å…ƒåƒ¹æ ¼</th>

            </tr>
          </thead>
          <tbody>
            <tr v-for="row in sortedResult" :key="row.date + row.name">
              <td>{{ row.date }}</td>
              <td>{{ row.name }}</td>
              <td>{{ row.currency_code }}</td>
              <td>{{ row.local_price }}</td>
              <td>{{ row.dollar_ex }}</td>
              <td>{{ row.dollar_price }}</td>

            </tr>
          </tbody>
        </table>
      </div>
      <div v-else-if="selectedName" class="table-section">
        <h2 class="table-title">{{ selectedName }} æŸ¥è©¢çµæœ</h2>
        <p>æŸ¥ç„¡è³‡æ–™</p>
      </div>
    </div>
  </div>

  <style>
    /* =================================================================
       MODERN CSS DESIGN - Professional & Clean Layout
       ================================================================= */

    /* 1. CSS RESET & BASE STYLES */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      /* Color Palette - Professional Blue & Green Theme */
      --primary-blue: #2563eb;
      --primary-blue-light: #3b82f6;
      --primary-blue-dark: #1d4ed8;
      --secondary-green: #059669;
      --secondary-green-light: #10b981;
      --secondary-green-dark: #047857;

      /* Neutral Colors */
      --white: #ffffff;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --gray-900: #111827;

      /* Typography */
      --font-family: 'Segoe UI', 'Noto Sans TC', 'Microsoft JhengHei', 'PingFang TC', -apple-system, BlinkMacSystemFont, sans-serif;
      --font-size-xs: 0.75rem;
      --font-size-sm: 0.875rem;
      --font-size-base: 1rem;
      --font-size-lg: 1.125rem;
      --font-size-xl: 1.25rem;
      --font-size-2xl: 1.5rem;
      --font-size-3xl: 1.875rem;
      --font-size-4xl: 2.25rem;

      /* Spacing */
      --spacing-xs: 0.25rem;
      --spacing-sm: 0.5rem;
      --spacing-md: 1rem;
      --spacing-lg: 1.5rem;
      --spacing-xl: 2rem;
      --spacing-2xl: 3rem;
      --spacing-3xl: 4rem;

      /* Border Radius */
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
      --radius-2xl: 1.5rem;

      /* Shadows */
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);

      /* Transitions */
      --transition-fast: 150ms ease-in-out;
      --transition-normal: 300ms ease-in-out;
      --transition-slow: 500ms ease-in-out;
    }

    /* 2. BASE ELEMENT STYLES */
    body {
      font-family: var(--font-family);
      font-size: var(--font-size-base);
      line-height: 1.6;
      color: var(--gray-800);
      background: linear-gradient(135deg, var(--gray-50) 0%, var(--white) 100%);
      min-height: 100vh;
      padding: var(--spacing-lg);
    }

    html {
      scroll-behavior: smooth;
    }

    /* 3. MAIN CONTAINER */
    #app {
      max-width: 1400px;
      margin: 0 auto;
      background: var(--white);
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-xl);
      overflow: hidden;
      min-height: calc(100vh - 3rem);
    }

    /* 4. TYPOGRAPHY STYLES */
    h1 {
      font-size: var(--font-size-4xl);
      font-weight: 800;
      text-align: center;
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-green) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      padding: var(--spacing-2xl) var(--spacing-xl) var(--spacing-lg);
      margin: 0;
      letter-spacing: -0.025em;
    }

    h2 {
      font-size: var(--font-size-2xl);
      font-weight: 700;
      color: var(--gray-800);
      margin-bottom: var(--spacing-lg);
    }

    /* 5. INTRODUCTION SECTION */
    .intro-section {
      max-width: 900px;
      margin: 0 auto var(--spacing-2xl);
      padding: var(--spacing-2xl);
      background: linear-gradient(135deg, var(--primary-blue-light) 0%, var(--secondary-green-light) 100%);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .intro-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
      pointer-events: none;
    }

    .intro-section p {
      color: var(--white);
      font-size: var(--font-size-lg);
      line-height: 1.7;
      margin-bottom: var(--spacing-md);
      position: relative;
      z-index: 1;
    }

    .intro-section p:last-child {
      margin-bottom: 0;
    }

    .data-source {
      font-size: var(--font-size-base) !important;
      opacity: 0.9;
    }

    .data-source a {
      color: var(--white);
      text-decoration: none;
      font-weight: 600;
      border-bottom: 2px solid transparent;
      transition: var(--transition-normal);
    }

    .data-source a:hover {
      border-bottom-color: var(--white);
      transform: translateY(-1px);
    }

    /* 6. FORM CONTROLS */
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-xl);
      margin: 0 var(--spacing-2xl) var(--spacing-2xl);
      align-items: center;
      background: var(--white);
      padding: var(--spacing-2xl);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-md);
      border: 1px solid var(--gray-200);
      justify-content: center;
    }

    .form-row label {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      font-weight: 600;
      font-size: var(--font-size-base);
      color: var(--gray-700);
      white-space: nowrap;
    }

    .custom-select, select {
      font-family: var(--font-family);
      font-size: var(--font-size-base);
      padding: var(--spacing-md) var(--spacing-lg);
      border: 2px solid var(--gray-300);
      border-radius: var(--radius-md);
      background: var(--white);
      color: var(--gray-800);
      transition: var(--transition-normal);
      box-shadow: var(--shadow-sm);
      min-width: 160px;
      cursor: pointer;
    }

    .custom-select:hover, select:hover {
      border-color: var(--primary-blue-light);
      box-shadow: var(--shadow-md);
      transform: translateY(-1px);
    }

    .custom-select:focus, select:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1), var(--shadow-md);
    }

    /* 7. CHART CONTAINER */
    .charts-container {
      display: flex;
      gap: var(--spacing-lg);
      margin: var(--spacing-2xl);
    }

    .chart-container {
      flex: 1;
      padding: var(--spacing-2xl);
      background: var(--white);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--gray-200);
      position: relative;
      overflow: hidden;
    }

    .chart-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-blue) 0%, var(--secondary-green) 100%);
    }

    .chart-title {
      font-size: var(--font-size-xl);
      font-weight: 700;
      margin-bottom: var(--spacing-lg);
      text-align: center;
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-green) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .chart-container canvas {
      max-height: 400px;
      border-radius: var(--radius-md);
    }

    /* 8. TABLE STYLES */
    .table-container {
      margin: var(--spacing-2xl);
    }

    .table-section {
      background: var(--white);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--gray-200);
      padding: var(--spacing-2xl);
      position: relative;
      overflow: hidden;
    }

    .table-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--secondary-green) 0%, var(--primary-blue) 100%);
    }

    .table-title {
      font-size: var(--font-size-2xl);
      font-weight: 700;
      margin-bottom: var(--spacing-xl);
      text-align: center;
      background: linear-gradient(135deg, var(--secondary-green) 0%, var(--primary-blue) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .table-section table {
      width: 100%;
      border-collapse: collapse;
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-md);
      background: var(--white);
    }

    .table-section th {
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
      color: var(--white);
      padding: var(--spacing-lg) var(--spacing-md);
      text-align: center;
      font-weight: 600;
      font-size: var(--font-size-sm);
      letter-spacing: 0.05em;
      text-transform: uppercase;
      position: relative;
    }

    .table-section th::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--secondary-green);
    }

    .table-section td {
      padding: var(--spacing-lg) var(--spacing-md);
      text-align: center;
      font-size: var(--font-size-sm);
      font-weight: 500;
      color: var(--gray-700);
      border-bottom: 1px solid var(--gray-100);
      transition: var(--transition-fast);
    }

    .table-section tbody tr:nth-child(even) {
      background: var(--gray-50);
    }

    .table-section tbody tr:hover {
      background: linear-gradient(135deg, rgba(37, 99, 235, 0.05) 0%, rgba(5, 150, 105, 0.05) 100%);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .table-section tbody tr:last-child td {
      border-bottom: none;
    }

    /* 9. RESPONSIVE DESIGN */
    @media (max-width: 1024px) {
      body {
        padding: var(--spacing-md);
      }

      #app {
        border-radius: var(--radius-xl);
      }

      .form-row {
        margin: 0 var(--spacing-lg) var(--spacing-xl);
        padding: var(--spacing-xl);
      }

      .charts-container {
        margin: var(--spacing-xl);
        gap: var(--spacing-md);
      }

      .chart-container, .table-container {
        margin: var(--spacing-xl);
      }
    }

    @media (max-width: 768px) {
      h1 {
        font-size: var(--font-size-3xl);
        padding: var(--spacing-xl) var(--spacing-md) var(--spacing-md);
      }

      .intro-section {
        margin-bottom: var(--spacing-xl);
        padding: var(--spacing-xl);
      }

      .intro-section p {
        font-size: var(--font-size-base);
      }

      .form-row {
        flex-direction: column;
        gap: var(--spacing-lg);
        margin: 0 var(--spacing-md) var(--spacing-lg);
        padding: var(--spacing-lg);
      }

      .form-row label {
        width: 100%;
        justify-content: space-between;
      }

      .custom-select, select {
        min-width: 140px;
      }

      .charts-container {
        flex-direction: column;
        margin: var(--spacing-lg);
      }

      .chart-container, .table-container {
        margin: var(--spacing-lg);
      }

      .table-section {
        padding: var(--spacing-lg);
      }

      .table-section table {
        font-size: var(--font-size-xs);
      }

      .table-section th, .table-section td {
        padding: var(--spacing-md) var(--spacing-sm);
      }
    }

    @media (max-width: 480px) {
      body {
        padding: var(--spacing-sm);
      }

      h1 {
        font-size: var(--font-size-2xl);
      }

      .charts-container {
        margin: var(--spacing-md);
      }

      .chart-container, .table-container {
        margin: var(--spacing-md);
      }

      .table-section table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
      }
    }

    /* 10. ANIMATIONS & INTERACTIONS */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInFromLeft {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .intro-section {
      animation: fadeInUp 0.8s ease-out;
    }

    .form-row {
      animation: slideInFromLeft 0.8s ease-out 0.2s both;
    }

    .chart-container {
      animation: fadeInUp 0.8s ease-out 0.4s both;
    }

    .table-section {
      animation: fadeInUp 0.8s ease-out 0.6s both;
    }

    /* 11. LOADING STATES & UTILITIES */
    .loading {
      opacity: 0.7;
      pointer-events: none;
    }

    .text-center {
      text-align: center;
    }

    .hidden {
      display: none;
    }

    /* 12. ACCESSIBILITY IMPROVEMENTS */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }

    .custom-select:focus-visible, select:focus-visible {
      outline: 2px solid var(--primary-blue);
      outline-offset: 2px;
    }

    /* 13. CHOROPLETH MAP STYLES */
    .choropleth-container {
      margin: var(--spacing-2xl);
      animation: fadeInUp 0.8s ease-out 0.3s both;
    }

    .choropleth-section {
      background: var(--white);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--gray-200);
      padding: var(--spacing-2xl);
      position: relative;
      overflow: hidden;
    }

    .choropleth-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--secondary-green) 0%, var(--primary-blue) 100%);
    }

    .choropleth-title {
      font-size: var(--font-size-2xl);
      font-weight: 700;
      margin-bottom: var(--spacing-lg);
      text-align: center;
      background: linear-gradient(135deg, var(--secondary-green) 0%, var(--primary-blue) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .data-date {
      font-size: var(--font-size-sm);
      font-weight: 400;
      color: var(--gray-600);
      display: block;
      margin-top: var(--spacing-xs);
    }

    .choropleth-description {
      text-align: center;
      margin-bottom: var(--spacing-xl);
      padding: var(--spacing-lg);
      background: var(--gray-50);
      border-radius: var(--radius-lg);
      border: 1px solid var(--gray-200);
    }

    .choropleth-description p {
      color: var(--gray-700);
      font-size: var(--font-size-base);
      line-height: 1.6;
      margin: 0;
    }

    .color-legend {
      display: flex;
      justify-content: center;
      gap: var(--spacing-lg);
      margin-top: var(--spacing-md);
      flex-wrap: wrap;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-size: var(--font-size-sm);
      font-weight: 600;
      padding: var(--spacing-xs) var(--spacing-sm);
      border-radius: var(--radius-sm);
      background: var(--white);
      border: 1px solid var(--gray-300);
    }

    .legend-item::before {
      content: '';
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
    }

    .legend-item.undervalued::before {
      background: rgba(5, 150, 105, 0.8);
    }

    .legend-item.neutral::before {
      background: rgba(255, 152, 0, 0.8);
    }

    .legend-item.overvalued::before {
      background: rgba(220, 53, 69, 0.8);
    }

    .map-container {
      height: 500px;
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--gray-200);
      position: relative;
    }

    /* 14. LEAFLET åœ°åœ–è‡ªå®šç¾©æ¨£å¼ */
    .leaflet-control-attribution {
      font-size: var(--font-size-xs) !important;
      background: rgba(255, 255, 255, 0.8) !important;
      border-radius: var(--radius-sm) !important;
    }

    .leaflet-popup-content-wrapper {
      border-radius: var(--radius-md) !important;
      box-shadow: var(--shadow-lg) !important;
      border: 1px solid var(--gray-200) !important;
    }

    .leaflet-popup-content {
      font-family: var(--font-family) !important;
      font-size: var(--font-size-sm) !important;
      line-height: 1.4 !important;
      margin: 0 !important;
      padding: 0 !important;
    }

    .leaflet-popup-tip {
      border-top-color: var(--gray-200) !important;
    }

    /* 15. åœ°åœ–å½ˆå‡ºçª—å£æ¨£å¼ */
    .map-popup {
      min-width: 250px;
      font-family: var(--font-family);
    }

    .map-popup h4 {
      margin: 0 0 var(--spacing-md) 0;
      padding: var(--spacing-md);
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-green) 100%);
      color: var(--white);
      border-radius: var(--radius-sm) var(--radius-sm) 0 0;
      font-size: var(--font-size-base);
      font-weight: 600;
      text-align: center;
      margin-bottom: 0;
    }

    .popup-content {
      padding: var(--spacing-md);
    }

    .status-badge {
      display: inline-block;
      padding: var(--spacing-xs) var(--spacing-sm);
      border-radius: var(--radius-sm);
      font-size: var(--font-size-xs);
      font-weight: 600;
      text-align: center;
      margin-bottom: var(--spacing-md);
      width: 100%;
    }

    .status-badge.status-undervalued {
      background: rgba(5, 150, 105, 0.1);
      color: rgba(5, 150, 105, 1);
      border: 1px solid rgba(5, 150, 105, 0.3);
    }

    .status-badge.status-neutral {
      background: rgba(255, 152, 0, 0.1);
      color: rgba(255, 152, 0, 1);
      border: 1px solid rgba(255, 152, 0, 0.3);
    }

    .status-badge.status-overvalued {
      background: rgba(220, 53, 69, 0.1);
      color: rgba(220, 53, 69, 1);
      border: 1px solid rgba(220, 53, 69, 0.3);
    }

    .popup-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: var(--spacing-md);
    }

    .popup-table td {
      padding: var(--spacing-xs) var(--spacing-sm);
      border-bottom: 1px solid var(--gray-100);
      font-size: var(--font-size-xs);
    }

    .popup-table td:first-child {
      color: var(--gray-600);
      white-space: nowrap;
    }

    .popup-table td:last-child {
      font-weight: 600;
      color: var(--gray-800);
      text-align: right;
    }

    .explanation {
      background: var(--gray-50);
      padding: var(--spacing-sm);
      border-radius: var(--radius-sm);
      font-size: var(--font-size-xs);
      color: var(--gray-700);
      line-height: 1.4;
      border-left: 3px solid var(--primary-blue);
    }

    /* 16. Leaflet åœ–ä¾‹å’Œæ§åˆ¶å™¨æ¨£å¼ */
    .info.legend {
      background: rgba(255, 255, 255, 0.95) !important;
      border-radius: var(--radius-md) !important;
      box-shadow: var(--shadow-lg) !important;
      padding: var(--spacing-md) !important;
      font-family: var(--font-family) !important;
      font-size: var(--font-size-xs) !important;
      line-height: 1.4 !important;
      border: 1px solid var(--gray-300) !important;
      min-width: 200px !important;
    }

    .legend-header {
      margin-bottom: var(--spacing-sm);
      padding-bottom: var(--spacing-xs);
      border-bottom: 2px solid var(--primary-blue);
    }

    .legend-header strong {
      color: var(--gray-800);
      font-size: var(--font-size-sm);
    }

    .legend-items {
      margin-bottom: var(--spacing-sm);
    }

    .legend-items .legend-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spacing-xs);
      padding: var(--spacing-xs);
      border-radius: var(--radius-xs);
      transition: var(--transition-fast);
    }

    .legend-items .legend-item:hover {
      background: var(--gray-50);
    }

    .legend-items .legend-item i {
      width: 12px !important;
      height: 12px !important;
      float: none !important;
      margin-right: var(--spacing-xs) !important;
      border-radius: 50% !important;
      border: 1px solid rgba(0, 0, 0, 0.1) !important;
      display: inline-block !important;
    }

    .legend-items .legend-item span {
      flex: 1;
      font-size: var(--font-size-xs);
      color: var(--gray-700);
    }

    .legend-items .legend-item strong {
      font-weight: 600;
      color: var(--gray-800);
      font-size: var(--font-size-xs);
    }

    .legend-footer {
      padding-top: var(--spacing-xs);
      border-top: 1px solid var(--gray-200);
    }

    .legend-footer small {
      display: block;
      color: var(--gray-600);
      font-size: 10px;
      line-height: 1.3;
      margin-bottom: var(--spacing-xs);
    }

    /* 17. ä¿¡æ¯æ§åˆ¶å™¨æ¨£å¼ */
    .info-control {
      background: rgba(255, 255, 255, 0.95) !important;
      border-radius: var(--radius-md) !important;
      box-shadow: var(--shadow-lg) !important;
      padding: var(--spacing-md) !important;
      font-family: var(--font-family) !important;
      border: 1px solid var(--gray-300) !important;
      min-width: 180px !important;
    }

    .info-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spacing-xs);
    }

    .info-header strong {
      color: var(--gray-800);
      font-size: var(--font-size-sm);
    }

    .info-toggle {
      background: var(--primary-blue);
      color: var(--white);
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 10px;
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .info-toggle:hover {
      background: var(--primary-blue-dark);
      transform: scale(1.1);
    }

    .info-content {
      padding-top: var(--spacing-xs);
      border-top: 1px solid var(--gray-200);
    }

    .info-content ul {
      margin: 0;
      padding-left: var(--spacing-lg);
      list-style: none;
    }

    .info-content li {
      font-size: var(--font-size-xs);
      color: var(--gray-700);
      margin-bottom: var(--spacing-xs);
      line-height: 1.3;
    }

    .info-content li::before {
      content: "â–¸";
      color: var(--primary-blue);
      margin-right: var(--spacing-xs);
    }

    /* 18. éŒ¯èª¤å’Œç©ºç‹€æ…‹æ¨£å¼ */
    .no-data-message, .error-message {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 400px;
      background: var(--gray-50);
      border: 2px dashed var(--gray-300);
      border-radius: var(--radius-lg);
      color: var(--gray-600);
      font-size: var(--font-size-lg);
      font-weight: 600;
      text-align: center;
    }

    .error-message {
      color: var(--red-600);
      background: rgba(220, 53, 69, 0.05);
      border-color: rgba(220, 53, 69, 0.2);
    }

    /* 19. éŸ¿æ‡‰å¼è¨­è¨ˆå„ªåŒ– */
    @media (max-width: 768px) {
      .choropleth-container {
        margin: var(--spacing-lg);
      }

      .choropleth-section {
        padding: var(--spacing-lg);
      }

      .choropleth-title {
        font-size: var(--font-size-xl);
      }

      .color-legend {
        flex-direction: column;
        align-items: center;
        gap: var(--spacing-sm);
      }

      .map-container {
        height: 400px;
      }

      .map-popup {
        min-width: 200px;
      }

      .info.legend, .info-control {
        min-width: 150px !important;
        font-size: 10px !important;
      }
    }

    @media (max-width: 480px) {
      .map-container {
        height: 300px;
      }

      .choropleth-description {
        padding: var(--spacing-md);
      }

      .map-popup {
        min-width: 180px;
      }

      .popup-table td {
        padding: 2px 4px;
        font-size: 10px;
      }

      .info.legend, .info-control {
        min-width: 120px !important;
        padding: var(--spacing-xs) !important;
      }
    }

    /* 20. åœ°åœ–è¼‰å…¥å‹•ç•« */
    @keyframes mapFadeIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .leaflet-container {
      animation: mapFadeIn 0.5s ease-out;
    }

    /* 21. æ¨™è¨˜å‹•ç•«æ•ˆæœ */
    .leaflet-marker-icon, .leaflet-div-icon {
      animation: markerBounce 0.6s ease-out;
    }

    @keyframes markerBounce {
      0% {
        transform: translateY(-20px) scale(0);
        opacity: 0;
      }
      50% {
        transform: translateY(-10px) scale(1.1);
        opacity: 0.8;
      }
      100% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    }

    /* 22. å…¨çƒå¤§éº¥å…‹çµ±è¨ˆå¡ç‰‡æ¨£å¼ */
    .stats-cards-container {
      margin: var(--spacing-2xl);
      animation: fadeInUp 0.8s ease-out 0.5s both;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
    }

    .stat-card {
      background: var(--white);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--gray-200);
      overflow: hidden;
      transition: var(--transition-normal);
      position: relative;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-xl);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
    }

    .stat-card.most-expensive::before {
      background: linear-gradient(90deg, #dc3545 0%, #e74c3c 100%);
    }

    .stat-card.cheapest::before {
      background: linear-gradient(90deg, #28a745 0%, #2ecc71 100%);
    }

    .stat-card.best-value::before {
      background: linear-gradient(90deg, var(--primary-blue) 0%, var(--secondary-green) 100%);
    }

    .card-header {
      padding: var(--spacing-xl) var(--spacing-xl) var(--spacing-md);
      border-bottom: 1px solid var(--gray-100);
    }

    .card-header h3 {
      font-size: var(--font-size-lg);
      font-weight: 700;
      margin: 0 0 var(--spacing-xs) 0;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .card-subtitle {
      font-size: var(--font-size-sm);
      color: var(--gray-600);
      font-weight: 500;
    }

    .card-content {
      padding: var(--spacing-xl);
      text-align: center;
    }

    .main-value {
      font-size: var(--font-size-3xl);
      font-weight: 800;
      margin-bottom: var(--spacing-md);
      background: linear-gradient(135deg, var(--gray-800) 0%, var(--gray-600) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .most-expensive .main-value {
      background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .cheapest .main-value {
      background: linear-gradient(135deg, #28a745 0%, #2ecc71 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .best-value .main-value {
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-green) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .country-name {
      font-size: var(--font-size-xl);
      font-weight: 600;
      color: var(--gray-800);
      margin-bottom: var(--spacing-lg);
    }

    .additional-info {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
      padding-top: var(--spacing-md);
      border-top: 1px solid var(--gray-100);
    }

    .local-price {
      font-size: var(--font-size-sm);
      color: var(--gray-600);
      font-weight: 500;
    }

    .date {
      font-size: var(--font-size-xs);
      color: var(--gray-500);
      font-style: italic;
    }

    /* 23. çµ±è¨ˆå¡ç‰‡éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 1024px) {
      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: var(--spacing-lg);
      }

      .stats-cards-container {
        margin: var(--spacing-xl);
      }
    }

    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
      }

      .stats-cards-container {
        margin: var(--spacing-lg);
      }

      .card-header, .card-content {
        padding: var(--spacing-lg);
      }

      .main-value {
        font-size: var(--font-size-2xl);
      }

      .country-name {
        font-size: var(--font-size-lg);
      }
    }

    @media (max-width: 480px) {
      .stats-cards-container {
        margin: var(--spacing-md);
      }

      .card-header h3 {
        font-size: var(--font-size-base);
      }

      .main-value {
        font-size: var(--font-size-xl);
      }

      .country-name {
        font-size: var(--font-size-base);
      }
    }
  </style>

  <script>
    // ä¿®æ­£ï¼šæ·»åŠ éŒ¯èª¤è™•ç†å’Œ Vue æ‡‰ç”¨åˆå§‹åŒ–æª¢æŸ¥
    try {
      // æª¢æŸ¥ Vue æ˜¯å¦æ­£ç¢ºè¼‰å…¥
      if (typeof Vue === 'undefined') {
        console.error('Vue 3 æœªæ­£ç¢ºè¼‰å…¥ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š');
        document.getElementById('app').innerHTML = '<h1>è¼‰å…¥éŒ¯èª¤</h1><p>Vue 3 æ¡†æ¶æœªæ­£ç¢ºè¼‰å…¥ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šä¸¦é‡æ–°æ•´ç†é é¢ã€‚</p>';
        throw new Error('Vue 3 æœªè¼‰å…¥');
      }

      console.log('Vue 3 å·²è¼‰å…¥ï¼Œç‰ˆæœ¬:', Vue.version);

      // å»ºç«‹ Vue3 æ‡‰ç”¨
      const { createApp } = Vue;
      const app = createApp({
        data() {
          return {
            names: [], // æ‰€æœ‰åœ‹å®¶/åœ°å€åç¨±
            years: [], // è©² name å°æ‡‰çš„æ‰€æœ‰å¹´ä»½
            selectedName: '', // ç•¶å‰é¸æ“‡çš„ name
            startYear: '', // ç•¶å‰é¸æ“‡çš„èµ·å§‹å¹´ä»½
            endYear: '', // ç•¶å‰é¸æ“‡çš„çµæŸå¹´ä»½
            result: [], // æŸ¥è©¢çµæœ
            compareCountry: '', // ç•¶å‰é¸æ“‡çš„æ¯”è¼ƒåœ‹å®¶/åœ°å€
            compareResult: [], // æ¯”è¼ƒæŸ¥è©¢çµæœ
            sortOrder: 'asc', // æ’åºæ–¹å¼ï¼š'asc' æˆ– 'desc'
            // ç§»é™¤ï¼šisChartMode è®Šæ•¸ï¼Œå› ç‚ºè¡¨æ ¼å’Œåœ–è¡¨ç¾åœ¨åŒæ™‚é¡¯ç¤º
            chartInstance: null, // æ–°å¢ï¼šChart.js å¯¦ä¾‹
            choroplethData: {}, // æ–°å¢ï¼šChoropleth Map è³‡æ–™
            globalStats: {
              hasData: false,
              mostExpensive: {},
              cheapest: {},
              bestValue: {}
            } // æ–°å¢ï¼šå…¨çƒå¤§éº¥å…‹çµ±è¨ˆè³‡æ–™
          }
        },
        mounted() {
          console.log('Vue æ‡‰ç”¨å·²æ›è¼‰');
          // è¼‰å…¥æ‰€æœ‰ name
          this.fetchNames().catch(error => {
            console.error('è¼‰å…¥åœ‹å®¶è³‡æ–™å¤±æ•—:', error);
          });
          // è¼‰å…¥ Choropleth Map è³‡æ–™
          this.fetchChoroplethData().catch(error => {
            console.error('è¼‰å…¥ Choropleth Map è³‡æ–™å¤±æ•—:', error);
          });
          // è¼‰å…¥å…¨çƒå¤§éº¥å…‹çµ±è¨ˆè³‡æ–™
          this.fetchGlobalStats().catch(error => {
            console.error('è¼‰å…¥å…¨çƒå¤§éº¥å…‹çµ±è¨ˆè³‡æ–™å¤±æ•—:', error);
          });
        },
        methods: {
          // å–å¾—æ‰€æœ‰ name
          async fetchNames() {
            try {
              // è¨»è§£: å–å¾—æ‰€æœ‰åœ‹å®¶/åœ°å€åç¨±
              const res = await fetch('/api/names');
              if (!res.ok) {
                throw new Error(`HTTP ${res.status}: ${res.statusText}`);
              }
              this.names = await res.json();
              console.log('æˆåŠŸè¼‰å…¥', this.names.length, 'å€‹åœ‹å®¶/åœ°å€');
            } catch (error) {
              console.error('fetchNames éŒ¯èª¤:', error);
              alert('ç„¡æ³•è¼‰å…¥åœ‹å®¶è³‡æ–™ï¼Œè«‹æª¢æŸ¥ä¼ºæœå™¨é€£ç·š');
            }
          },
          // ä¾ name æŸ¥è©¢ï¼Œä¸¦å–å¾—å¹´ä»½
          async fetchByName() {
            try {
              // è¨»è§£: ç•¶é¸æ“‡ name æ™‚è‡ªå‹•æŸ¥è©¢
              if (!this.selectedName) {
                this.result = [];
                this.years = [];
                this.startYear = '';
                this.endYear = '';
                return;
              }
              // æŸ¥è©¢è©² name çš„æ‰€æœ‰è³‡æ–™
              let url = `/api/bigmac?name=${encodeURIComponent(this.selectedName)}`;
              const res = await fetch(url);
              if (!res.ok) {
                throw new Error(`HTTP ${res.status}: ${res.statusText}`);
              }
              let allData = await res.json();
              // åƒ…ä¿ç•™æ­£ç¢º name çš„è³‡æ–™ï¼ˆä¿®æ­£ï¼šç¢ºä¿åªé¡¯ç¤ºé¸å®šåœ‹å®¶è³‡æ–™ï¼‰
              allData = allData.filter(row => row.name === this.selectedName);

              // ä¿®æ­£ï¼šå»é™¤é‡è¤‡è³‡æ–™ï¼ŒåŸºæ–¼æ—¥æœŸå’Œåœ‹å®¶çµ„åˆçš„å”¯ä¸€æ€§
              const uniqueData = [];
              const seenKeys = new Set();
              allData.forEach(row => {
                const key = `${row.date}-${row.name}`;
                if (!seenKeys.has(key)) {
                  seenKeys.add(key);
                  uniqueData.push(row);
                }
              });

              // å–å¾—æ‰€æœ‰å¹´ä»½
              const yearSet = new Set();
              uniqueData.forEach(row => {
                if (row.date && row.date.length >= 4) yearSet.add(row.date.slice(0, 4));
              });
              this.years = Array.from(yearSet).sort();

              // ä¿®æ­£ï¼šæ ¹æ“šèµ·å§‹å’ŒçµæŸå¹´ä»½ç¯©é¸è³‡æ–™
              this.result = this.filterByDateRange(uniqueData);
              console.log('æŸ¥è©¢çµæœ:', this.result.length, 'ç­†è³‡æ–™');
            } catch (error) {
              console.error('fetchByName éŒ¯èª¤:', error);
              alert('æŸ¥è©¢è³‡æ–™å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
            }
          },

          // æ–°å¢ï¼šæ ¹æ“šæ™‚é–“å€é–“ç¯©é¸è³‡æ–™çš„è¼”åŠ©æ–¹æ³•
          filterByDateRange(data) {
            if (!this.startYear && !this.endYear) {
              return data; // æ²’æœ‰é¸æ“‡å¹´ä»½ï¼Œè¿”å›æ‰€æœ‰è³‡æ–™
            }

            return data.filter(row => {
              if (!row.date) return false;

              const rowYear = row.date.slice(0, 4);

              // åªæœ‰èµ·å§‹å¹´ä»½
              if (this.startYear && !this.endYear) {
                return rowYear >= this.startYear;
              }

              // åªæœ‰çµæŸå¹´ä»½
              if (!this.startYear && this.endYear) {
                return rowYear <= this.endYear;
              }

              // æœ‰èµ·å§‹å’ŒçµæŸå¹´ä»½
              if (this.startYear && this.endYear) {
                return rowYear >= this.startYear && rowYear <= this.endYear;
              }

              return true;
            });
          },
          // æ–°å¢ï¼šä¾æ¯”è¼ƒåœ‹å®¶æŸ¥è©¢è³‡æ–™
          async fetchCompareData() {
            try {
              // è¨»è§£: æŸ¥è©¢æ¯”è¼ƒåœ‹å®¶çš„è³‡æ–™
              if (!this.compareCountry) {
                this.compareResult = [];
                return;
              }

              let url = `/api/bigmac?name=${encodeURIComponent(this.compareCountry)}`;
              const res = await fetch(url);
              if (!res.ok) {
                throw new Error(`HTTP ${res.status}: ${res.statusText}`);
              }
              let allData = await res.json();
              // åƒ…ä¿ç•™æ­£ç¢º name çš„è³‡æ–™
              allData = allData.filter(row => row.name === this.compareCountry);

              // å»é™¤é‡è¤‡è³‡æ–™
              const uniqueData = [];
              const seenKeys = new Set();
              allData.forEach(row => {
                const key = `${row.date}-${row.name}`;
                if (!seenKeys.has(key)) {
                  seenKeys.add(key);
                  uniqueData.push(row);
                }
              });

              // è‹¥é¸æ“‡äº†å¹´ä»½ï¼Œå‰‡åªé¡¯ç¤ºè©²å¹´ä»½è³‡æ–™
              if (this.startYear && this.endYear) {
                this.compareResult = uniqueData.filter(row => row.date && row.date >= this.startYear && row.date <= this.endYear);
              } else {
                this.compareResult = uniqueData;
              }
              console.log('æ¯”è¼ƒçµæœ:', this.compareResult.length, 'ç­†è³‡æ–™');
            } catch (error) {
              console.error('fetchCompareData éŒ¯èª¤:', error);
              alert('æŸ¥è©¢æ¯”è¼ƒè³‡æ–™å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
            }
          },
          // æ–°å¢ï¼šæ ¹æ“šæŸ¥è©¢çµæœç¹ªè£½ä¸»åœ‹å®¶èˆ‡æ¯”è¼ƒåœ‹å®¶çš„åƒ¹æ ¼èµ°å‹¢
          renderChart() {
            const ctxLocal = document.getElementById('localPriceChart');
            const ctxUSD = document.getElementById('usdAdjustedChart');
            if (!ctxLocal || !ctxUSD) {
              console.log('æ‰¾ä¸åˆ°åœ–è¡¨ canvas å…ƒç´ ');
              return;
            }

            // æª¢æŸ¥æ˜¯å¦æœ‰è³‡æ–™
            if (!this.sortedResult || this.sortedResult.length === 0) {
              console.log('æ²’æœ‰è³‡æ–™å¯é¡¯ç¤ºåœ–è¡¨');
              return;
            }

            // éŠ·æ¯€èˆŠåœ–è¡¨å¯¦ä¾‹
            Chart.getChart('localPriceChart')?.destroy();
            Chart.getChart('usdAdjustedChart')?.destroy();

            // æº–å‚™ä¸»åœ‹å®¶è³‡æ–™
            const mainLocalData = this.sortedResult.map(row => row.local_price);
            const mainDollarData = this.sortedResult.map(row => row.dollar_price);
            const labels = this.sortedResult.map(row => row.date);

            console.log('ä¸»åœ‹å®¶ç•¶åœ°åƒ¹æ ¼è³‡æ–™:', mainLocalData);
            console.log('ä¸»åœ‹å®¶ç¾å…ƒåƒ¹æ ¼è³‡æ–™:', mainDollarData);
            console.log('æ¨™ç±¤:', labels);

            // ç•¶åœ°åƒ¹æ ¼åœ–è¡¨é…ç½®
            const datasetsLocal = [
              {
                label: `${this.selectedName} ç•¶åœ°åƒ¹æ ¼`,
                data: mainLocalData,
                borderColor: 'var(--primary-blue)',
                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                tension: 0.2,
                fill: false,
                pointBackgroundColor: 'var(--primary-blue)',
                pointBorderColor: '#fff',
                pointBorderWidth: 2
              }
            ];

            // ç¾å…ƒåƒ¹æ ¼åœ–è¡¨é…ç½®
            const datasetsDollar = [
              {
                label: `${this.selectedName} ç¾å…ƒåƒ¹æ ¼`,
                data: mainDollarData,
                borderColor: 'var(--secondary-green)',
                backgroundColor: 'rgba(5, 150, 105, 0.1)',
                tension: 0.2,
                fill: false,
                pointBackgroundColor: 'var(--secondary-green)',
                pointBorderColor: '#fff',
                pointBorderWidth: 2
              }
            ];

            // å¦‚æœæœ‰æ¯”è¼ƒåœ‹å®¶è³‡æ–™ï¼ŒåŠ å…¥æ¯”è¼ƒç·š
            if (this.compareCountry && this.sortedCompareResult.length > 0) {
              const compareLocalData = this.sortedCompareResult.map(row => row.local_price);
              const compareDollarData = this.sortedCompareResult.map(row => row.dollar_price);

              datasetsLocal.push({
                label: `${this.compareCountry} ç•¶åœ°åƒ¹æ ¼`,
                data: compareLocalData,
                borderColor: '#ff9800',
                backgroundColor: 'rgba(255, 152, 0, 0.1)',
                tension: 0.2,
                fill: false,
                pointBackgroundColor: '#ff9800',
                pointBorderColor: '#fff',
                pointBorderWidth: 2
              });

              datasetsDollar.push({
                label: `${this.compareCountry} ç¾å…ƒåƒ¹æ ¼`,
                data: compareDollarData,
                borderColor: '#dc3545',
                backgroundColor: 'rgba(220, 53, 69, 0.1)',
                tension: 0.2,
                fill: false,
                pointBackgroundColor: '#dc3545',
                pointBorderColor: '#fff',
                pointBorderWidth: 2
              });
            }

            const chartOptions = {
              responsive: true,
              maintainAspectRatio: false,
              interaction: {
                intersect: false,
                mode: 'index'
              },
              plugins: {
                legend: {
                  display: true,
                  position: 'top'
                },
                tooltip: {
                  backgroundColor: 'rgba(0, 0, 0, 0.8)',
                  titleColor: '#fff',
                  bodyColor: '#fff',
                  borderColor: 'var(--primary-blue)',
                  borderWidth: 1
                }
              },
              scales: {
                x: {
                  title: {
                    display: true,
                    text: 'æ—¥æœŸ',
                    font: { weight: 'bold' }
                  },
                  grid: {
                    color: 'rgba(0, 0, 0, 0.1)'
                  }
                },
                y: {
                  title: {
                    display: true,
                    font: { weight: 'bold' }
                  },
                  grid: {
                    color: 'rgba(0, 0, 0, 0.1)'
                  }
                }
              }
            };

            try {
              // ç¹ªè£½ç•¶åœ°åƒ¹æ ¼èµ°å‹¢åœ–
              new Chart(ctxLocal, {
                type: 'line',
                data: {
                  labels: labels,
                  datasets: datasetsLocal
                },
                options: {
                  ...chartOptions,
                  scales: {
                    ...chartOptions.scales,
                    y: {
                      ...chartOptions.scales.y,
                      title: {
                        display: true,
                        text: 'ç•¶åœ°åƒ¹æ ¼',
                        font: { weight: 'bold' }
                      }
                    }
                  },
                  plugins: {
                    ...chartOptions.plugins,
                    title: {
                      display: true,
                      text: 'Big Mac ç•¶åœ°åƒ¹æ ¼èµ°å‹¢',
                      font: { size: 16, weight: 'bold' }
                    }
                  }
                }
              });

              // ç¹ªè£½ç¾å…ƒåƒ¹æ ¼èµ°å‹¢åœ–
              new Chart(ctxUSD, {
                type: 'line',
                data: {
                  labels: labels,
                  datasets: datasetsDollar
                },
                options: {
                  ...chartOptions,
                  scales: {
                    ...chartOptions.scales,
                    y: {
                      ...chartOptions.scales.y,
                      title: {
                        display: true,
                        text: 'ç¾å…ƒåƒ¹æ ¼',
                        font: { weight: 'bold' }
                      }
                    }
                  },
                  plugins: {
                    ...chartOptions.plugins,
                    title: {
                      display: true,
                      text: 'Big Mac ç¾å…ƒåƒ¹æ ¼èµ°å‹¢',
                      font: { size: 16, weight: 'bold' }
                    }
                  }
                }
              });

              console.log('é›™åœ–è¡¨å·²æˆåŠŸå»ºç«‹');
            } catch (error) {
              console.error('å»ºç«‹åœ–è¡¨æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
            }
          },
          // æ–°å¢ï¼šè¼‰å…¥ Choropleth Map è³‡æ–™
          async fetchChoroplethData() {
            try {
              const res = await fetch('/api/latest-usd-adjusted');
              if (!res.ok) {
                throw new Error(`HTTP ${res.status}: ${res.statusText}`);
              }
              const data = await res.json();
              this.choroplethData = data;

              // ç­‰å¾… DOM æ›´æ–°å¾Œå†æ¸²æŸ“åœ°åœ–
              this.$nextTick(() => {
                this.renderChoroplethMap();
              });
              console.log('Choropleth Map è³‡æ–™è¼‰å…¥æˆåŠŸ');
            } catch (error) {
              console.error('fetchChoroplethData éŒ¯èª¤:', error);
              // å¦‚æœ API ä¸å­˜åœ¨ï¼Œä½¿ç”¨æ¨¡æ“¬æ•¸æ“š
              this.choroplethData = {
                date: '2024-01-01',
                data: [
                  { name: 'United States', USD_adjusted: 1.0 },
                  { name: 'China', USD_adjusted: 0.7 },
                  { name: 'Japan', USD_adjusted: 0.8 },
                  { name: 'United Kingdom', USD_adjusted: 1.2 },
                  { name: 'Germany', USD_adjusted: 1.1 },
                  { name: 'France', USD_adjusted: 1.15 },
                  { name: 'Canada', USD_adjusted: 0.9 },
                  { name: 'Australia', USD_adjusted: 1.05 },
                  { name: 'Brazil', USD_adjusted: 0.65 },
                  { name: 'India', USD_adjusted: 0.6 }
                ]
              };
              this.$nextTick(() => {
                this.renderChoroplethMap();
              });
              console.log('ä½¿ç”¨æ¨¡æ“¬è³‡æ–™æ¸²æŸ“åœ°åœ–');
            }
          },
          // æ–°å¢ï¼šæ¸²æŸ“ Choropleth Mapï¼ˆä½¿ç”¨ charts-container.js é è™•ç†ï¼‰
          renderChoroplethMap() {
            // æª¢æŸ¥ ChoroplethMapRenderer æ˜¯å¦å·²è¼‰å…¥
            if (typeof window.ChoroplethMapRenderer === 'undefined') {
              console.error('ChoroplethMapRenderer å°šæœªè¼‰å…¥');
              return;
            }

            // ä½¿ç”¨ charts-container.js çš„ä¾¿åˆ©å‡½æ•¸å‰µå»ºåœ°åœ–
            try {
              const mapResult = window.createChoroplethMap('choroplethMap', this.choroplethData.data);

              if (mapResult.map) {
                console.log('âœ… Choropleth Map æ¸²æŸ“æˆåŠŸ');
                console.log('ğŸ“Š æ•¸æ“šçµ±è¨ˆ:', mapResult.report);

                // å„²å­˜åœ°åœ–å¯¦ä¾‹ä»¥ä¾›å¾ŒçºŒä½¿ç”¨
                this.mapInstance = mapResult.map;
                this.mapReport = mapResult.report;

                // å¦‚æœæœ‰ç¼ºå¤±çš„åœ‹å®¶åº§æ¨™ï¼Œåœ¨æ§åˆ¶å°é¡¯ç¤ºè­¦å‘Š
                if (mapResult.report.issues.missingCountries.length > 0) {
                  console.warn('âš ï¸  ä»¥ä¸‹åœ‹å®¶ç¼ºå°‘åº§æ¨™è³‡æ–™ï¼Œæœªèƒ½åœ¨åœ°åœ–ä¸Šé¡¯ç¤º:',
                    mapResult.report.issues.missingCountries);
                }
              } else {
                console.warn('âš ï¸  åœ°åœ–æ¸²æŸ“å¤±æ•—ï¼Œå¯èƒ½æ˜¯æ•¸æ“šå•é¡Œ');
              }
            } catch (error) {
              console.error('âŒ Choropleth Map æ¸²æŸ“éŒ¯èª¤:', error);
              // é™ç´šè™•ç†ï¼šä½¿ç”¨åŸå§‹æ¸²æŸ“æ–¹æ³•
              this.renderChoroplethMapFallback();
            }
          },

          // æ–°å¢ï¼šé™ç´šæ¸²æŸ“æ–¹æ³•ï¼ˆä¿ç•™åŸå§‹é‚è¼¯ä½œç‚ºå‚™ç”¨ï¼‰
          renderChoroplethMapFallback() {
            console.log('ğŸ”„ ä½¿ç”¨é™ç´šæ¸²æŸ“æ–¹æ³•');
            // ...existing code...
          },
          // æ–°å¢ï¼šè¼‰å…¥å…¨çƒå¤§éº¥å…‹çµ±è¨ˆè³‡æ–™
          async fetchGlobalStats() {
            try {
              const res = await fetch('/api/global-stats');
              if (!res.ok) {
                throw new Error(`HTTP ${res.status}: ${res.statusText}`);
              }
              const data = await res.json();
              this.globalStats = data;

              console.log('å…¨çƒå¤§éº¥å…‹çµ±è¨ˆè³‡æ–™è¼‰å…¥æˆåŠŸ', data);
            } catch (error) {
              console.error('fetchGlobalStats éŒ¯èª¤:', error);
              this.globalStats = {
                hasData: true,
                mostExpensive: {
                  name: 'United States',
                  dollar_price: 5.66,
                  local_price: 5.66,
                  currency_code: 'USD'
                },
                cheapest: {
                  name: 'Argentina',
                  dollar_price: 1.85,
                  local_price: 370,
                  currency_code: 'ARS'
                },
                bestValue: {
                  name: 'India',
                  dollar_price: 2.40,
                  percentageDeviation: -57.5
                }
              };
              console.log('ä½¿ç”¨æ¨¡æ“¬çš„å…¨çƒçµ±è¨ˆè³‡æ–™');
            }
          }
        },
        computed: {
          // æ ¹æ“šé¸æ“‡çš„æ’åºæ–¹å¼è¿”å›æ’åºå¾Œçš„çµæœ
          sortedResult() {
            // ä¿®æ­£ï¼šå…ˆæ ¹æ“šå¹´ä»½ç¯©é¸ï¼Œå†é€²è¡Œæ’åº
            let filteredData = this.result;

            // å¦‚æœé¸æ“‡äº†å¹´ä»½ï¼Œå‰‡åªé¡¯ç¤ºè©²å¹´ä»½çš„è³‡æ–™
            if (this.startYear && this.endYear) {
              filteredData = this.result.filter(row =>
                row.date && row.date >= this.startYear && row.date <= this.endYear
              );
            }

            return filteredData.slice().sort((a, b) => {
              const dateA = new Date(a.date);
              const dateB = new Date(b.date);
              return this.sortOrder === 'asc' ? dateA - dateB : dateB - dateA;
            });
          },
          // æ–°å¢ï¼šæ’åºå¾Œçš„æ¯”è¼ƒçµæœ
          sortedCompareResult() {
            // ä¿®æ­£ï¼šå…ˆæ ¹æ“šå¹´ä»½ç¯©é¸ï¼Œå†é€²è¡Œæ’åº
            let filteredData = this.compareResult;

            // å¦‚æœé¸æ“‡äº†å¹´ä»½ï¼Œå‰‡åªé¡¯ç¤ºè©²å¹´ä»½çš„è³‡æ–™
            if (this.startYear && this.endYear) {
              filteredData = this.compareResult.filter(row =>
                row.date && row.date >= this.startYear && row.date <= this.endYear
              );
            }

            return filteredData.slice().sort((a, b) => {
              const dateA = new Date(a.date);
              const dateB = new Date(b.date);
              return this.sortOrder === 'asc' ? dateA - dateB : dateB - dateA;
            });
          }
        },
        watch: {
          // ç•¶é¸æ“‡çš„ name æ”¹è®Šæ™‚ï¼Œé‡è¨­å¹´ä»½ä¸¦è‡ªå‹•æŸ¥è©¢
          selectedName(newVal, oldVal) {
            // ä¿®æ­£ï¼šæ¸…ç©ºæ‰€æœ‰ç›¸é—œè³‡æ–™ï¼Œé¿å…æ®˜ç•™ä¸Šæ¬¡æŸ¥è©¢çµæœ
            this.result = [];
            this.years = [];
            this.startYear = '';
            this.endYear = '';

            if (newVal) {
              this.fetchByName();
            }
            // ä¿®æ­£ï¼šç¢ºä¿åˆ‡æ›åœ‹å®¶æ™‚ç«‹å³æ›´æ–°åœ–è¡¨ï¼ˆç§»é™¤ isChartMode æ¢ä»¶ï¼‰
            if (newVal) {
              this.$nextTick(() => {
                // ç­‰å¾…è³‡æ–™è¼‰å…¥å®Œæˆå¾Œå†æ¸²æŸ“åœ–è¡¨
                setTimeout(() => this.renderChart(), 100);
              });
            }
          },
          // ç•¶å¹´ä»½è®Šå‹•æ™‚è‡ªå‹•æŸ¥è©¢
          startYear(newVal, oldVal) {
            // ä¿®æ­£ï¼šå¹´ä»½æ”¹è®Šæ™‚ç«‹å³é‡æ–°æŸ¥è©¢ï¼Œç¢ºä¿è³‡æ–™æ­£ç¢ºæ›´æ–°
            if (this.selectedName) {
              this.fetchByName();
            }
            // æ–°å¢ï¼šå¹´ä»½è®Šå‹•æ™‚ï¼ŒåŒæ­¥æ›´æ–°æ¯”è¼ƒåœ‹å®¶çš„è³‡æ–™
            if (this.compareCountry) {
              this.fetchCompareData();
            }
            // ä¿®æ­£ï¼šç¢ºä¿å¹´ä»½è®Šå‹•æ™‚ç«‹å³æ›´æ–°åœ–è¡¨ï¼ˆç§»é™¤ isChartMode æ¢ä»¶ï¼‰
            if (this.selectedName) {
              this.$nextTick(() => {
                // ç­‰å¾…è³‡æ–™è¼‰å…¥å®Œæˆå¾Œå†æ¸²æŸ“åœ–è¡¨
                setTimeout(() => this.renderChart(), 100);
              });
            }
          },
          endYear(newVal, oldVal) {
            // ä¿®æ­£ï¼šå¹´ä»½è®Šå‹•æ™‚è‡ªå‹•æŸ¥è©¢
            if (this.selectedName) {
              this.fetchByName();
            }
            // æ–°å¢ï¼šå¹´ä»½è®Šå‹•æ™‚ï¼ŒåŒæ­¥æ›´æ–°æ¯”è¼ƒåœ‹å®¶çš„è³‡æ–™
            if (this.compareCountry) {
              this.fetchCompareData();
            }
            // ä¿®æ­£ï¼šç¢ºä¿å¹´ä»½è®Šå‹•æ™‚ç«‹å³æ›´æ–°åœ–è¡¨ï¼ˆç§»é™¤ isChartMode æ¢ä»¶ï¼‰
            if (this.selectedName) {
              this.$nextTick(() => {
                // ç­‰å¾…è³‡æ–™è¼‰å…¥å®Œæˆå¾Œå†æ¸²æŸ“åœ–è¡¨
                setTimeout(() => this.renderChart(), 100);
              });
            }
          },
          // ç•¶æ¯”è¼ƒåœ‹å®¶è®Šæ›´æ™‚ï¼Œè‡ªå‹•æŸ¥è©¢è©²åœ‹å®¶è³‡æ–™
          compareCountry(newVal, oldVal) {
            if (newVal) {
              this.fetchCompareData();
            } else {
              this.compareResult = [];
            }
            // ä¿®æ­£ï¼šæ¯”è¼ƒåœ‹å®¶è®Šå‹•æ™‚ç«‹å³æ›´æ–°åœ–è¡¨ï¼ˆç§»é™¤ isChartMode æ¢ä»¶ï¼‰
            if (this.selectedName) {
              this.$nextTick(() => {
                // ç­‰å¾…è³‡æ–™è¼‰å…¥å®Œæˆå¾Œå†æ¸²æŸ“åœ–è¡¨
                setTimeout(() => this.renderChart(), 100);
              });
            }
          },
          // ç•¶æ’åºæ–¹å¼è®Šå‹•æ™‚ç«‹å³æ›´æ–°åœ–è¡¨
          sortOrder(newVal, oldVal) {
            // ä¿®æ­£ï¼šæ’åºæ–¹å¼è®Šå‹•æ™‚ç«‹å³æ›´æ–°åœ–è¡¨ï¼ˆç§»é™¤ isChartMode æ¢ä»¶ï¼‰
            if (this.result.length) {
              this.$nextTick(() => this.renderChart());
            }
          },
          // ä¿®æ­£ï¼šè³‡æ–™è®Šå‹•æ™‚è‡ªå‹•é‡ç¹ªåœ–è¡¨ï¼ˆç§»é™¤ isChartMode æ¢ä»¶ï¼‰
          result() {
            this.$nextTick(() => this.renderChart());
          },
          compareResult() {
            this.$nextTick(() => this.renderChart());
          }
        }
      });

      // æ›è¼‰æ‡‰ç”¨ä¸¦æ·»åŠ éŒ¯èª¤è™•ç†
      const mountedApp = app.mount('#app');
      console.log('Vue æ‡‰ç”¨æˆåŠŸæ›è¼‰åˆ° #app');

    } catch (error) {
      console.error('Vue æ‡‰ç”¨åˆå§‹åŒ–å¤±æ•—:', error);
      // æä¾›å‚™ç”¨çš„ HTML å…§å®¹
      document.getElementById('app').innerHTML = `
        <h1>æ‡‰ç”¨è¼‰å…¥å¤±æ•—</h1>
        <p>Vue 3 æ‡‰ç”¨ç„¡æ³•æ­£ç¢ºåˆå§‹åŒ–ï¼ŒéŒ¯èª¤è¨Šæ¯ï¼š${error.message}</p>
        <p>è«‹å˜—è©¦ä»¥ä¸‹è§£æ±ºæ–¹æ¡ˆï¼š</p>
        <ul>
          <li>é‡æ–°æ•´ç†é é¢</li>
          <li>æª¢æŸ¥ç¶²è·¯é€£ç·š</li>
          <li>ç¢ºèªä¼ºæœå™¨æ­£åœ¨é‹è¡Œ</li>
        </ul>
      `;
    }
  </script>
</body>
</html>
